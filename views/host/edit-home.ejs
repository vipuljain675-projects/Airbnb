<%- include('../partials/head') %>
<body class="bg-light">
<%- include('../partials/nav') %>

<main class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-8">

      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-body p-4">

          <h2 class="fw-bold mb-4 text-center">
            <%= editing ? "Edit your Home" : "Add a New Home" %>
          </h2>

          <form action="/host/<%= editing ? 'edit-home' : 'add-home' %>"
                method="POST" enctype="multipart/form-data">

            <% if (editing) { %>
              <input type="hidden" name="id" value="<%= home._id %>">
            <% } %>

            <!-- Property Name -->
            <div class="mb-3">
              <label class="form-label fw-semibold">House Name</label>
              <input type="text" name="houseName"
                     class="form-control form-control-lg"
                     value="<%= home.houseName || '' %>" required>
            </div>

            <!-- Price & Rating -->
            <div class="row mb-3">
              <div class="col">
                <label class="form-label fw-semibold">Price / Night</label>
                <input type="number" name="price"
                       class="form-control form-control-lg"
                       value="<%= home.price || '' %>" required>
              </div>
              <div class="col">
                <label class="form-label fw-semibold">Rating</label>
                <input type="number" step="0.1" name="rating"
                       class="form-control form-control-lg"
                       value="<%= home.rating || '' %>" required>
              </div>
            </div>

            <!-- Location -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Location</label>
              <input type="text" name="location"
                     class="form-control form-control-lg"
                     value="<%= home.location || '' %>" required>
            </div>

            <!-- IMAGE UPLOAD (FIXED UX) -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Property Images (max 3)</label>

              <label for="imageUpload"
                     class="w-100 border rounded-4 p-4 text-center bg-white"
                     style="cursor:pointer; border-style:dashed;">
                <div id="imagePreview" class="d-flex gap-3 justify-content-center flex-wrap">
                  <% if (editing && home.photoUrl) { %>
                    <% home.photoUrl.forEach(img => { %>
                      <img src="<%= img %>"
                           class="rounded shadow-sm"
                           style="width:100px;height:100px;object-fit:cover;">
                    <% }) %>
                  <% } else { %>
                    <div class="text-muted">
                      <div style="font-size:2.5rem;">ï¼‹</div>
                      <div>Add photos</div>
                    </div>
                  <% } %>
                </div>
              </label>

              <input type="file"
                     id="imageUpload"
                     name="photos"
                     class="d-none"
                     multiple
                     accept="image/*"
                     onchange="previewImages(event)">
            </div>

            <!-- Description -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Description</label>
              <textarea name="description"
                        class="form-control form-control-lg"
                        rows="4"><%= home.description || '' %></textarea>
            </div>

            <!-- Submit -->
            <div class="d-grid">
              <button class="btn btn-primary btn-lg">
                <%= editing ? "Update Home" : "Add Home" %>
              </button>
            </div>

          </form>

        </div>
      </div>

    </div>
  </div>
</main>

<script>
  function previewImages(event) {
    const files = event.target.files;
    const preview = document.getElementById('imagePreview');
    preview.innerHTML = '';

    Array.from(files).forEach(file => {
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.width = '100px';
        img.style.height = '100px';
        img.style.objectFit = 'cover';
        img.className = 'rounded shadow-sm';
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  }
</script>

</body>
</html>
