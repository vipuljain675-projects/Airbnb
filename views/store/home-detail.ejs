<%- include('../partials/head') %>
<body>
<%- include('../partials/nav') %>

<main class="container mt-4">

  <h1 class="fw-bold mb-1"><%= home.houseName %></h1>
  <p class="text-muted"><%= home.location %></p>

  <!-- Images -->
  <div class="row mb-4">
    <% home.photoUrl.forEach(img => { %>
      <div class="col-md-4 mb-3">
        <img src="<%= img %>" class="img-fluid rounded shadow-sm"
             style="height:250px; object-fit:cover;">
      </div>
    <% }) %>
  </div>

  <h4>â‚¹<%= home.price %> / night</h4>
  <p class="mt-3"><%= home.description %></p>

  <!-- ðŸ”µ MAP RESTORED -->
  <div class="mt-5">
    <h4 class="mb-3">Where youâ€™ll be</h4>
    <div id="map" style="height: 350px;"></div>
  </div>

  <div class="mt-4 d-flex gap-3">
    <a href="/reserve/<%= home._id %>" class="btn btn-primary">
      Reserve
    </a>

    <form action="/favourite" method="POST">
      <input type="hidden" name="homeId" value="<%= home._id %>">
      <button class="btn btn-outline-danger">
        Add to Favourites
      </button>
    </form>
  </div>

</main>

<!-- ðŸ§  MAP SCRIPT -->
<script>
  // SIMPLE ADDRESS-BASED MAP (NO API KEY)
  fetch('https://nominatim.openstreetmap.org/search?format=json&q=<%= home.location %>')
    .then(res => res.json())
    .then(data => {
      if (!data || data.length === 0) return;

      const lat = data[0].lat;
      const lon = data[0].lon;

      const map = L.map('map').setView([lat, lon], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
      }).addTo(map);

      L.marker([lat, lon])
        .addTo(map)
        .bindPopup("<%= home.houseName %>")
        .openPopup();
    });
</script>

</body>
</html>
